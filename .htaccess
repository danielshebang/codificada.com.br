# Protege arquivos sensíveis
<FilesMatch "\.(env|log|sql|bak|git)$">
    Require all denied
</FilesMatch>

# Desativa a listagem de diretórios
Options -Indexes

# Redireciona para HTTPS
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Protege o arquivo .htaccess
<Files ".htaccess">
    Require all denied
</Files>

# Bloqueia acesso a arquivos PHP em uploads
<Directory /var/www/html/uploads>
    <FilesMatch "\.php$">
        Require all denied
    </FilesMatch>
</Directory>

# Habilita compressão gzip para melhorar o desempenho
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/json
</IfModule>

# Retira o WWW
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

# Configura cache para imagens
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/png "access plus 7 days"
</IfModule>

# Configura cabeçalhos de segurança
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=()"
</IfModule>

# Configura páginas de erro personalizadas
ErrorDocument 404 https://dvmb.com.br/erros/404.html
ErrorDocument 403 https://dvmb.com.br/erros/403.html
ErrorDocument 500 https://dvmb.com.br/erros/500.html